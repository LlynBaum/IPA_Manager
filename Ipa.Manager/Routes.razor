@using Microsoft.AspNetCore.Components.Authorization
@using Ipa.Manager.Components
@using Ipa.Manager.Auth

@if (IsLoginPage)
{
    <Router AppAssembly="@typeof(App).Assembly">
        <Found Context="routeData">
            <RouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)" />
        </Found>
    </Router>
}
else
{
    <CascadingUserContext>
        <AuthorizeView>
            <Authorized>
                <Router AppAssembly="@typeof(App).Assembly">
                    <Found Context="routeData">
                        <RouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)" />
                    </Found>
                </Router>
            </Authorized>

            <NotAuthorized>
                <RedirectToLogin />
            </NotAuthorized>
        </AuthorizeView>
    </CascadingUserContext>
}

@code {
    [Inject] NavigationManager Nav { get; set; } = default!;

    bool IsLoginPage => new Uri(Nav.Uri).AbsolutePath.Equals("/login", StringComparison.OrdinalIgnoreCase);
}

